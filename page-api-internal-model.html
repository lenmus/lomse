<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Lomse library. API documentation: The Document API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="lomse.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_100x195.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Lomse library. API documentation
   &#160;<span id="projectnumber">0.29.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('page-api-internal-model.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">The Document API </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#api-internal-model-intro">Accesing and modifying the document</a></li>
<li class="level1"><a href="#api-internal-model-adocument">The ADocument class</a><ul><li class="level2"><a href="#api-internal-model-adocument-content">ADocument content</a></li>
</ul>
</li>
<li class="level1"><a href="#api-internal-model-scores">The structure of a music score</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="api-internal-model-intro"></a>
Accesing and modifying the document</h1>
<p>Lomse operates in the domain of music books and music scores. That is, Lomse deals with documents, written in LDP language, containing texts, images, scores, exercises, graphics, headers, footers, etc. Also deals with music scores written in other languages, such as MusicXML.</p>
<p>A file written in MusicXML or LDP languages is an 'external representation' of a music score or a music document, that is, something oriented to be stored in a file. This type of representation is not the most appropriate for processing. Therefore, when a MusicXML or LDP file is read by Lomse, the file content is transformed into a suitable format in memory, more flexible and powerful for processing. This representation is named the <em>Internal Model</em> .</p>
<p>The internal model is accessible for your application through the <a class="el" href="classADocument.html">ADocument</a> object. This object represents a lomse document and provides access to its content, so that your application can interact with the document, get information from it and change things. You can even create the document content from scratch instead of loading its content from an external file.</p>
<p>Until now, this API object didn't exist and to manipulate the internal model you had to access lomse internal objects and understand the <em>Internal Model</em>. The need for an stable API hiding all internal details is clear, to get two main benefits:</p><ol type="1">
<li>The internal model will be really ‘internal’ and could be improved for new features and fixes without affecting user applications.</li>
<li>The library API will be stable, and user oriented, removing all internals.</li>
</ol>
<p>Therefore, lomse is starting to define and offer a user oriented API for accessing the internal model. This API is in development and, currently, only a few classes and methods are available. Meanwhile you application will continue having access to the lomse internal model classes but this access will be, in future, removed.</p>
<p>Defining and implementing the public API will take its time and will be done little by little. It is strongly recommended to use the new API classes when available instead of accessing internal objects. But, for backwards compatibility, as your application could be using methods not yet moved to the public API, all API classes include a bridge method <code>get_internal_object()</code> that provides access to the most relevant internal model object, so that you can migrate your code and still use internal classes for methods not yet migrated. Notice that this helper method <b>will be removed in future</b> so, please, if you need to use it, open an issue explaining the need, so that the public API could be fixed as soon as possible and your app. would not be affected in future when these backwards compatibility methods are removed.</p>
<h1><a class="anchor" id="api-internal-model-adocument"></a>
The ADocument class</h1>
<p>The document is accessible through the <a class="el" href="classADocument.html">ADocument</a> class, that represents the whole document. This object can be accessed by method <a class="el" href="classPresenter.html#a70bf977c8264b4756d3f1b7a2598cae6">Presenter::get_document()</a>. You could think of the <a class="el" href="classADocument.html">ADocument</a> as the root node of a DOM like structure representing the document. And the children of this root element represent the basic blocks for building a document: headers, paragraphs, music scores, lists, tables, images, etc.</p>
<p>For music scores the DOM model analogy is not truly feasible as many music notation markings (like a slur or beam) are represented by pairs or sets of elements. By using just a tree structure there is no automatic way to ensure consistency between these elements. Therefore, lomse or any other program have to maintain self-consistency when there are 'paired elements' representing the starts and ends of things like beams, crescendo markings, slurs, and so on. Therefore, the <em>Internal Model</em> contains additional structures for correctly representing a music score.</p>
<p>It is important to note that the <em>Internal Model</em> and its associated structures form an abstract representation for a document, containing all necessary information to derive any other representation when needed. It is not oriented to any particular use (rendering, playback, printing, music analysis, document edition, ...) but try to serve all them equally. In this way the Document can serve to the purpose of any View object: a view can either be a print out of a conventional music score; or it can be a textual representation in LDP or any other language; or it can be a playback oriented representation, such a table of MIDI events; or any other representation for any purpose. When a particular use is intended, the corresponding optimized representation is derived from the <em>Internal Model</em> by Lomse.</p>
<h2><a class="anchor" id="api-internal-model-adocument-content"></a>
ADocument content</h2>
<p>You can think on a document as a container for the visible content (music scores, paragraphs, etc.) and some additional properties and metadata:</p>
<div class="fragment"><div class="line">Document := metadata + content</div><div class="line">content := collection of &lt;i&gt;block-level&lt;/i&gt; objects (paragraphs, music scores, tables, etc).</div></div><!-- fragment --><p>For structuring the content of a document, lomse follows an approach similar to that of HTML (but not exactly equal), and classifies document content objects in two classes: <em>block-level</em> objects and <em>inline-level</em> objects.</p>
<p>In a lomse, document first level content items are always <em>block-level</em> objects. They define independent areas in a document, such as a paragraph or a music score. <em>block-level</em> objects can be considered as boxes to wrap the content, and they may content other <em>block-level</em> objects and <em>inline-level</em> objects. Generally, <em>block-level</em> objects begin on new lines, whereas <em>inline-level</em> objects do not.</p>
<p><em>Inline-level</em> objects must always be included as part of a <em>block-level</em> object, and may contain only data and other <em>inline-level</em> objects.</p>
<p>In lomse, there are three types of <em>block-level</em> objects:</p><ol type="1">
<li>blocks-container objects: they only contain more <em>block-level</em> objects, e.g.: ATable contains ATableCell and ATableRow objects.</li>
<li>inlines-container objects: they only contain <em>inline-level</em> objects, e.g.: <a class="el" href="classAParagraph.html">AParagraph</a> contains <a class="el" href="classATextItem.html">ATextItem</a> objects.</li>
<li>music score objects: an specialized blocks-container for containing a music score (class <a class="el" href="classAScore.html">AScore</a>).</li>
</ol>
<p>As you can see, document content is organized in a tree, and the first level nodes are always <em>block-level</em> objects. For example, let's analyse the structure of a real document, the following LMD document:</p>
<div class="fragment"><div class="line">&lt;?<span class="keyword">xml</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0&quot;</span> <span class="keyword">encoding</span>=<span class="stringliteral">&quot;UTF-8&quot;</span>?&gt;</div><div class="line">&lt;<span class="keywordtype">lenmusdoc</span> <span class="keyword">vers</span>=<span class="stringliteral">&quot;0.0&quot;</span> <span class="keyword">language</span>=<span class="stringliteral">&quot;en&quot;</span>&gt;</div><div class="line">   &lt;<span class="keywordtype">content</span>&gt; </div><div class="line">      &lt;<span class="keywordtype">section</span> <span class="keyword">level</span>=<span class="stringliteral">&quot;1&quot;</span>&gt;1. <span class="keyword">A</span> <span class="keyword">simple</span> <span class="keyword">music</span> <span class="keyword">score</span>&lt;/<span class="keywordtype">section</span>&gt; </div><div class="line">      &lt;<span class="keywordtype">para</span>&gt;</div><div class="line">        <span class="keyword">The</span> <span class="keyword">next</span> <span class="keyword">example</span> <span class="keyword">is</span> <span class="keyword">just</span> <span class="keyword">a</span> <span class="keyword">simple</span> <span class="keyword">music</span> <span class="keyword">score.</span></div><div class="line">        <span class="keyword">It</span> <span class="keyword">only</span> <span class="keyword">has</span> <span class="keyword">one</span> <span class="keyword">staff</span>, <span class="keyword">a</span> <span class="keyword">G</span> <span class="keyword">clef</span>, <span class="keyword">a</span> <span class="keyword">key</span> <span class="keyword">signature</span> (<span class="keyword">A</span> <span class="keyword">major</span>)</div><div class="line">        <span class="keyword">and</span> <span class="keyword">two</span> <span class="keyword">notes:</span> <span class="keyword">a</span> <span class="keyword">quarter</span> <span class="keyword">note</span> <span class="keyword">and</span> <span class="keyword">an</span> <span class="keyword">eighth</span> <span class="keyword">note.</span></div><div class="line">      &lt;/<span class="keywordtype">para</span>&gt; </div><div class="line">      &lt;<span class="keywordtype">ldpmusic</span>&gt;</div><div class="line">        (<span class="keyword">score</span> (<span class="keyword">vers</span> 2.0)</div><div class="line">            (<span class="keyword">instrument</span></div><div class="line">                (<span class="keyword">musicData</span></div><div class="line">                    (<span class="keyword">clef</span> <span class="keyword">G</span>)</div><div class="line">                    (<span class="keyword">key</span> <span class="keyword">A</span>)</div><div class="line">                    (<span class="keyword">n</span> <span class="keyword">a4</span> <span class="keyword">q</span>)</div><div class="line">                    (<span class="keyword">n</span> <span class="keyword">c5</span> <span class="keyword">e</span>)</div><div class="line">                )</div><div class="line">            )</div><div class="line">        )</div><div class="line">      &lt;/<span class="keywordtype">ldpmusic</span>&gt;</div><div class="line">      &lt;<span class="keywordtype">para</span>&gt;<span class="keyword">Do</span> <span class="keyword">you</span> <span class="keyword">like</span> <span class="keyword">it</span>?&lt;/<span class="keywordtype">para</span>&gt; </div><div class="line">   &lt;/<span class="keywordtype">content</span>&gt;</div><div class="line">&lt;/<span class="keywordtype">lenmusdoc</span>&gt;</div></div><!-- fragment --><p>will be is rendered by Lomse as:</p>
<div class="image">
<img src="document-example.png" alt="document-example.png"/>
<div class="caption">
Image: Rendering of previous LMD document.</div></div>
<p>And from the API point of view you can think of this document as a tree represented by the following objects:</p>
<pre class="fragment">                              ADocument
                                  |
         ┌────────────────┬───────┴────────┬──────────────────┐
         |                |                |                  |
      IHeading       AParagraph         AScore           AParagraph
         |                |                |                  |
     ATextItem        ATextItem           ...             ATextItem


.        
</pre><p>As you can see, the API tree follows, basically, the same structure than that of a LenMus document (LMD) and an score follows the same structure than its LDP source.</p>
<p>For content other than music scores the structure is similar to that of an HTML document. But for music scores there is some additional information added to the model. See next section <a class="el" href="page-api-internal-model.html#api-internal-model-scores">The structure of a music score</a> for details.</p>
<h1><a class="anchor" id="api-internal-model-scores"></a>
The structure of a music score</h1>
<p>The <a class="el" href="classAScore.html">AScore</a> object represents a full music score, that is, an object comprising all of the music for all of the players and their instruments, typically laid out in a specific order. In a full score, instruments are usually grouped by sharing barlines and having some visual clues, such as a brace or bracket, and a group name. The visual groupings we see in a piece of music can be classified as:</p>
<ul>
<li>Staff - a set of horizontal lines, where musical notation can be arranged for display.</li>
<li>Grand staff - two staves vertically linked by a curly brace, and sharing measure barlines, used for instruments having enough range to be confusing when put on a single staff. (e.g. piano or organ). For some instruments, such as organ, it could have more than two staves.</li>
<li>Instruments group - a set of staves or grand staves connected by a curly or square brace, used to indicate that the instruments involved are closely linked (e.g. SATB voices or 8 Horns). Sometimes, all instruments in the group share measure barlines.</li>
<li>System - a set of staves, grand staves, and/or grouped staves connected, at start, by a vertical system barline, representing every part in the current layout.</li>
</ul>
<p>The two first, staves and grand staves, are represented in lomse by an <a class="el" href="classAInstrument.html">AInstrument</a> object: the staff or staves associated to a physical musical instrument.</p>
<p>The third one, instruments groups, are represented in lomse by <a class="el" href="classAInstrGroup.html">AInstrGroup</a> objects: the layout information for grouping some instruments.</p>
<p>Finally, systems, are represented by internal objects managed by lomse.</p>
<p>Thus, in lomse, an score is, basically, some global information such as score titles, and two collections: the collection instruments (<a class="el" href="classAInstrument.html">AInstrument</a> objects) and the collection of defined instrument groups (<a class="el" href="classAInstrGroup.html">AInstrGroup</a> objects). </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Overview</a></li>
    <li class="footer">Generated on Sat May 14 2022 16:53:09 for Lomse library. API documentation by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
