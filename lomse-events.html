<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Lomse library. API documentation: Events and Requests</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="lomse.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_100x195.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Lomse library. API documentation
   &#160;<span id="projectnumber">0.21.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Overview</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="modules.html"><span>Types&#160;and&#160;constants</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li class="current"><a href="pages.html"><span>Other</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('lomse-events.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Events and Requests </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#notifications">Notifications: events and requests</a></li>
<li class="level1"><a href="#handlig-events">Handling events</a><ul><li class="level2"><a href="#view-events">View events</a></li>
<li class="level2"><a href="#document-events">Document events</a></li>
</ul>
</li>
<li class="level1"><a href="#handlig-requests">Handling requests</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="notifications"></a>
Notifications: events and requests</h1>
<p>As Lomse is platform independent code, it knows nothing about your platform mechanisms for creating events. For this reason, all Lomse communication with the user application takes place through <em>notifications</em>. They are sent to your application by invoking a callback function. Your application, in this function, will process the notifications as more appropiate, probably by creating <code>real</code> events for your platform and posting them to be processed when appropriate.</p>
<p>Lomse <em>notifications</em> can be divided into two categories based on how they are created and how they are processed:</p>
<ul>
<li><b>Events</b>. They are informative notifications: the Lomse library just informs the user application about something, for instance, about a mouse click. Normally, the user application has to do some action but Lomse doesn't expect anything, and continues processing without waiting for any answer. Events can refer:<ul>
<li>To a View, i.e. a <em>playback higlight</em> event, or a <em>window update</em> event.</li>
<li>To a Document or its content, i.e. a <em>mouse click</em> event; and</li>
<li>To a Control object, i.e. a click on a link control.</li>
</ul>
</li>
<li><b>Requests</b>. When Lomse needs some information or some platform dependent service it sends a <em><a class="el" href="classRequest.html">Request</a></em>. Lomse process is paused until the user application provides the requested data.</li>
</ul>
<h1><a class="anchor" id="handlig-events"></a>
Handling events</h1>
<p>It is not mandatory to handle Lomse events. But normally, your application will need to handle at least the <code>k_update_window_event</code>.</p>
<p>To capture and handle an event you must register an <code>event handler</code> on the object generating the events by invoking its <code>add_event_handler()</code> method. Your handler can be:</p>
<ul>
<li>a C function,</li>
<li>a C++ method, or</li>
<li>a C++ object, derived form lomse::EventHandler.</li>
</ul>
<p>All Lomse objects that generate events derive from lomse::Observable class. Currently, events can be generated by the following objects:</p>
<ul>
<li>A View. You must register must register an <code>event handler</code> on the <a class="el" href="classInteractor.html">Interactor</a> for handling the View events.</li>
<li>A Document or a document object (ImoContentObj); and</li>
<li>A Control object.</li>
</ul>
<p>The parameters for the <code>add_event_handler()</code> method depends on the type of handler method. There are three posibilities:</p>
<p>a) The handler is a C function: </p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> add_handler(<span class="keywordtype">int</span> eventType, <span class="keywordtype">void</span> (*pt2Func)(<a class="code" href="group__typedefs.html#ga4d059e9b3deace601d55c1d9e51e0ed9">SpEventInfo</a> event) );</div>
</div><!-- fragment --><p>b) The handler is a C++ method: </p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> add_handler(<span class="keywordtype">int</span> eventType, <span class="keywordtype">void</span>* pThis,</div>
<div class="line">                 <span class="keywordtype">void</span> (*pt2Func)(<span class="keywordtype">void</span>* pObj, <a class="code" href="group__typedefs.html#ga4d059e9b3deace601d55c1d9e51e0ed9">SpEventInfo</a> event) );</div>
</div><!-- fragment --><p>c) The handler is a C++ object derived form lomse::EventHandler: </p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> add_handler(<span class="keywordtype">int</span> eventType, <a class="code" href="classEventHandler.html">EventHandler</a>* pHandler);</div>
</div><!-- fragment --><p>The parameters for these methods are:</p>
<ul>
<li><code>eventType</code> is the event type you wish to handle, such as a mouse click.</li>
<li><code>SpEventInfo</code> is an shared pointer to the event object. All events derive from <code>lomse::EventInfo</code> class.</li>
</ul>
<p>For the C function case:</p>
<ul>
<li><code>pt2Func</code> is a pointer to the C function that will handle the event. It expects only one parameter: a shared pointer to the Event object.</li>
</ul>
<p>For C++ method case:</p>
<ul>
<li><code>pThis</code> is a pointer to the object that will handle the event.</li>
<li><code>pt2Func</code> is a pointer to the member method that will handle the event. It must be an <b>static method</b>. It will receive as first parameter the pointer to the object, so that you can invoke non-static methods if necessary.</li>
</ul>
<p>And for the C++ object case:</p>
<ul>
<li><code>pHandler</code> is a pointer to an object derived from <a class="el" href="classEventHandler.html">EventHandler</a> that will handle the event. It must implement method <code>handle_event()</code>.</li>
</ul>
<p>Example:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (SpInteractor spInteractor = m_pPresenter-&gt;get_interactor(0).lock())</div>
<div class="line">{</div>
<div class="line">    <span class="comment">//connect the View with the window buffer</span></div>
<div class="line">    spInteractor-&gt;set_rendering_buffer(&amp;m_rbuf_window);</div>
<div class="line"></div>
<div class="line">    <span class="comment">//register to receive some events</span></div>
<div class="line">    spInteractor-&gt;add_event_handler(<a class="code" href="group__enumerations.html#ggabfcf510bafec7c6429906a6ecaac656daf6c7408c96763e94fd2df7d6235f7a49">k_update_window_event</a>, <span class="keyword">this</span>, wrapper_update_window);</div>
<div class="line">    spInteractor-&gt;add_event_handler(<a class="code" href="group__enumerations.html#ggabfcf510bafec7c6429906a6ecaac656da57b1f32291d0c7d644177111f483a398">k_do_play_score_event</a>, <span class="keyword">this</span>, wrapper_play_score);</div>
<div class="line">    spInteractor-&gt;add_event_handler(<a class="code" href="group__enumerations.html#ggabfcf510bafec7c6429906a6ecaac656da144a5f912218153c12ac8f00c1fb938a">k_pause_score_event</a>, <span class="keyword">this</span>, wrapper_play_score);</div>
<div class="line">    spInteractor-&gt;add_event_handler(<a class="code" href="group__enumerations.html#ggabfcf510bafec7c6429906a6ecaac656da70fda4ac3bd78865b2b5c69b98806ffa">k_stop_playback_event</a>, <span class="keyword">this</span>, wrapper_play_score);</div>
<div class="line">    ...</div>
</div><!-- fragment --><h2><a class="anchor" id="view-events"></a>
View events</h2>
<p>Events generated by a View must be handled by adding a handler to the <a class="el" href="classInteractor.html">Interactor</a> associated to that View.</p>
<p>Here is a list of all events generated by the View. For more information on each event read the class documentation for the event.</p>
<p><b>Global View events:</b></p>
<ul>
<li><a class="el" href="classEventPaint.html">EventPaint</a> (event type <code>k_update_window_event</code>) - Ask user app to update window with current bitmap.</li>
<li><a class="el" href="classEventUpdateViewport.html">EventUpdateViewport</a> (event type <code>k_update_viewport_event</code>) - Ask user app to update viewport origin using provided coordinates.</li>
</ul>
<p><b>Events related to selecting objects:</b></p>
<ul>
<li><a class="el" href="classEventUpdateUI.html">EventUpdateUI</a> (event type <code>k_selection_set_change</code>) - Selected objects changed</li>
<li><a class="el" href="classEventUpdateUI.html">EventUpdateUI</a> (event type <code>k_pointed_object_change</code>) - Cursor pointing to a different object</li>
</ul>
<p><b>Events implying a posible edition command:</b></p>
<ul>
<li><a class="el" href="classEventControlPointMoved.html">EventControlPointMoved</a> (event type <code>k_control_point_moved_event</code>) - User moves a handler: handler released event</li>
</ul>
<p><b>Events related to score playback:</b></p>
<ul>
<li><a class="el" href="classEventScoreHighlight.html">EventScoreHighlight</a> (event type <code>k_highlight_on_event</code>) - Add highlight to a note/rest</li>
<li><a class="el" href="classEventScoreHighlight.html">EventScoreHighlight</a> (event type <code>k_highlight_off_event</code>) - Remove highlight from a note/rest</li>
<li><a class="el" href="classEventScoreHighlight.html">EventScoreHighlight</a> (event type <code>k_end_of_higlight_event</code>) - End of score play back. Remove all highlight.</li>
<li><a class="el" href="classEventScoreHighlight.html">EventScoreHighlight</a> (event type <code>k_advance_tempo_line_event</code>) -</li>
<li><a class="el" href="classEventPlayScore.html">EventPlayScore</a> (event type <code>k_end_of_playback_event</code>) - End of playback. User application is informed just in case it would like to do any action (i.e. re-enabling playback button).</li>
</ul>
<h2><a class="anchor" id="document-events"></a>
Document events</h2>
<p>These events are generated by the Document. For handling them you will have to register a handler function either to the Document object or to the desired elements (ImoContentObj objects).</p>
<p><b>Mouse events when interacting with Document objects:</b></p>
<ul>
<li><a class="el" href="classEventMouse.html">EventMouse</a> (event type <code>k_mouse_in_event</code>) - Mouse goes over an object</li>
<li><a class="el" href="classEventMouse.html">EventMouse</a> (event type <code>k_mouse_out_event</code>) - Mouse goes out from an object</li>
<li><a class="el" href="classEventMouse.html">EventMouse</a> (event type <code>k_on_click_event</code>) - Document, ImoContentObj: click on object</li>
<li><a class="el" href="classEventMouse.html">EventMouse</a> (event type <code>k_show_contextual_menu_event</code>) - Click event: object selected and menu request</li>
</ul>
<p><b>Events related to score playback:</b></p>
<ul>
<li><a class="el" href="classEventPlayScore.html">EventPlayScore</a> (event type <code>k_do_play_score_event</code>) - Start/resume playback</li>
<li><a class="el" href="classEventPlayScore.html">EventPlayScore</a> (event type <code>k_pause_score_event</code>) - Pause playback</li>
<li><a class="el" href="classEventPlayScore.html">EventPlayScore</a> (event type <code>k_stop_playback_event</code>) - Stop playback</li>
</ul>
<h1><a class="anchor" id="handlig-requests"></a>
Handling requests</h1>
<p>It is mandatory to handle Lomse requests. For this, you have to set up a callback method (at library initialization). For instance:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>MyApp</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    ...</div>
<div class="line">    <span class="comment">//callbacks</span></div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> lomse_request_handler_method(<span class="keywordtype">void</span>* pThis, <a class="code" href="classRequest.html">Request</a>* pRequest);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> MyApp::initialize_lomse()</div>
<div class="line">{</div>
<div class="line">    ...</div>
<div class="line">    <span class="comment">//initialize the library with these values</span></div>
<div class="line">    m_lomse.init_library(pixel_format, resolution, reverse_y_axis, m_lomseReporter);</div>
<div class="line"></div>
<div class="line">    <span class="comment">//set callback for requests</span></div>
<div class="line">    m_lomse.set_request_callback(<span class="keyword">this</span>, lomse_request_handler_method);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> MyApp::lomse_request_handler_method(<span class="keywordtype">void</span>* pThis, <a class="code" href="classRequest.html">Request</a>* pRequest)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static_cast&lt;</span>MyApp*<span class="keyword">&gt;</span>(pThis)-&gt;on_lomse_request(pRequest);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> MyApp::on_lomse_request(<a class="code" href="classRequest.html">Request</a>* pRequest)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> type = pRequest-&gt;<a class="code" href="classRequest.html#aa1cef2d8dbdc04772277ce2ddeda6687">get_request_type</a>();</div>
<div class="line">    <span class="keywordflow">switch</span> (type)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">case</span> k_dynamic_content_request:</div>
<div class="line">            generate_dynamic_content( dynamic_cast&lt;RequestDynamic*&gt;(pRequest) );</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__enumerations.html#gga0dc84b6205af6b43ac7867cd9779dfcca478758eacf0fde44f569dc2b7ead827e">k_get_font_filename</a>:</div>
<div class="line">            get_font_filename( dynamic_cast&lt;RequestFont*&gt;(pRequest) );</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            LogError(<span class="stringliteral">&quot;Unknown request %d&quot;</span>, type);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>Lomse will make any necessary request by invoking this callback method. Therefore, requests are always handled in a single point in your application.</p>
<p>When your callback method is invoked, it will receive as parameter an object derived from class <a class="el" href="classRequest.html">Request</a>, containing the information about the required information or platform dependent service. And Lomse process is paused until the user application provides the requested data.</p>
<p>The list of posible Requests is:</p>
<ul>
<li><a class="el" href="classRequestDynamic.html">RequestDynamic</a>. While parsing an LDP document, a <code>(dynamic)</code> element has been found. Lomse is requesting user application for the dynamic content that must be inserted.</li>
<li><a class="el" href="classRequestFont.html">RequestFont</a>. The font used for an element is not available in Lomse package. Lomse requests the file path for the font. </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Overview</a></li>
    <li class="footer">Generated on Mon Jan 1 2018 18:58:22 for Lomse library. API documentation by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
