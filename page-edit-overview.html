<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Lomse library. API documentation: Editing documents overview</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="lomse.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_100x195.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Lomse library. API documentation
   &#160;<span id="projectnumber">0.24.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Overview</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="modules.html"><span>Types&#160;and&#160;constants</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li class="current"><a href="pages.html"><span>Other</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('page-edit-overview.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Editing documents overview </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#edit-overview">How to modify a document</a></li>
<li class="level1"><a href="#edit-high-level">The high-level API: edition commands</a><ul><li class="level2"><a href="#edit-overview-undo">Undo/Redo</a></li>
<li class="level2"><a href="#edit-overview-cursor">Cursor and selections</a></li>
</ul>
</li>
<li class="level1"><a href="#edit-modes">Supported edition modes</a></li>
<li class="level1"><a href="#edit-commands">Edition commands</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="edit-overview"></a>
How to modify a document</h1>
<p>When a source document (in LDP or MusicXML format) is loaded, it is not stored as text or as an XML <a class="el" href="classDocument.html">Document</a> Object Model (<em>DOM</em>). Instead, the document is parsed and an <em>Internal Model</em> is built. The <em>Internal Model</em> is, mainly, a tree structure in memory. The root element of the <em>Internal Model</em> tree represents the whole document. And the children of the root element represent the basic blocks for building a document: headers, paragraphs, music scores, lists, etc. For an overview of the <em>Internal Model</em> see <a class="el" href="page-internal-model.html">Document internal representation</a>.</p>
<p>Once the <em>Internal Model</em> is created, for modifying the document your application has two options, either</p>
<ol type="1">
<li>use the edition commands API; or</li>
<li>directly modify the internal model.</li>
</ol>
<p><b>Edition commands</b> are a high level API for supporting edition. It is based on executing commands and provides undo/redo (that is, reverting the last change done to the document and to reverting the undo by re-executing the undone command). It is appropriate for applications whising to provide an interface to the user for editing documents (e.g. a music score notation editor application).</p>
<p><b>Direct internal model manipulation</b> is a low level API. Your application directly accesses the <em>Internal Model</em> and modifies the internal <em>Internal Model</em> structures. Obviously, there are no high level related services such as undo/redo and good knowledge of the internal model and related structures is needed for maintainin consistency. This API, faster and more flexible, is appropriate for applications that programatically create and modify documents (e.g. an application for creating random music scores).</p>
<p>Of course, both APIs are compatible and can be used by your application for offering different services.</p>
<p>The rest of this page describes the high level API using edition commands. For a description of the low level API see <a class="el" href="page-im-modification.html">The low level edition API</a>.</p>
<h1><a class="anchor" id="edit-high-level"></a>
The high-level API: edition commands</h1>
<p>All edition commands are objects derived from base abstract class <a class="el" href="classDocCommand.html">DocCommand</a>, and they work by modifying the <em>Internal Model</em> tree, either by inserting or removing elements or by modifying the attributes of an element. For instance, <a class="el" href="classCmdInsertBlockLevelObj.html">CmdInsertBlockLevelObj()</a> is a command for inserting a block level object. This command, as well as most commands for inserting new elements, require a parameter with the source code of the element to insert. Currently the source code for all edition commands must be in LMD format.</p>
<p>Executing a command is just invoking <a class="el" href="classInteractor.html#ac0f2b87ac27d4d4a4692dc9ce5b42291">Interactor::exec_command()</a> method and passing the command to execute, for instance:</p>
<div class="fragment"><div class="line">    <span class="comment">//insert a paragraph and an empty music score</span></div>
<div class="line">    <span class="keywordflow">if</span> (SpInteractor spInteractor = m_pPresenter-&gt;get_interactor(0).lock())</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">string</span> src = <span class="stringliteral">&quot;&lt;para&gt;This is a short paragraph&lt;/para&gt;&quot;</span>;</div>
<div class="line">        SpInteractor-&gt;exec_command( <span class="keyword">new</span> <a class="code" href="classCmdInsertBlockLevelObj.html">CmdInsertBlockLevelObj</a>(src, <span class="stringliteral">&quot;Add paragraph&quot;</span>) );</div>
<div class="line"></div>
<div class="line">        src = <span class="stringliteral">&quot;&lt;ldpmusic&gt;(score (vers 2.0)(instrument (musicData)))&lt;/ldpmusic&gt;&quot;</span>;</div>
<div class="line">        SpInteractor-&gt;exec_command( <span class="keyword">new</span> <a class="code" href="classCmdInsertBlockLevelObj.html">CmdInsertBlockLevelObj</a>(src, <span class="stringliteral">&quot;Add empty music score&quot;</span>) );</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="edit-overview-undo"></a>
Undo/Redo</h2>
<p>Undo/redo operations refer, respectively, to reverting the last change done to the document and to reverting the undo by re-executing the undone command.</p>
<p>Lomse provides full support for implementing undo/redo in your application. It maintains two queues: the history of executed commands and the list of commands that can be re-done. And Lomse provides two methods for undo/redo operations:</p>
<ul>
<li>For undoing the last command in the queue just invoke <a class="el" href="classInteractor.html#a827410e940b1c1d7bcc42414d73a33aa">Interactor::exec_undo()</a> method.</li>
<li>For redoing the operation in the queue just invoke <a class="el" href="classInteractor.html#a6571c803f6a3626793756119821101e8">Interactor::exec_redo()</a> method.</li>
</ul>
<p>In addition, to facilitate that your application can enable and disable undo/redo buttons, commands and other GUI widgets related to undo/redo, Lomse provides information about the undo and redo history:</p>
<ul>
<li>method <a class="el" href="classInteractor.html#abd162053d322ad64eb94159e1437ce1e">Interactor::should_enable_edit_undo()</a> returns <span class="literal">true</span> if there are commands in the undo queue, and</li>
<li>method <a class="el" href="classInteractor.html#a1fb104713775c65888909f3f1404faad">Interactor::should_enable_edit_redo()</a> returns <span class="literal">true</span> if there are commands in the redo queue.</li>
</ul>
<h2><a class="anchor" id="edit-overview-cursor"></a>
Cursor and selections</h2>
<p>Most edition commands require a reference point in the document. For instance, a command such as <em>delete paragraph</em> would require a pointer to the paragraph to delete. Or a command <em>insert note</em> would require a pointer to the point in which the note must be inserted. For providing these references, Lomse maintains two objects: a DocCursor object and a SelectionSet object.</p>
<p>The DocCursor object is just a pointer to an element in the document. You can think of it as the graphic cursor in text edition applications, but in Lomse, there are two objects: the DocCursor and the Caret.</p>
<p>The cursor is just an internal invisible pointer; and the caret is the graphical representation of the cursor position. Lomse maintains the synchronization between the cursor and the caret, so advancing the cursor automatically forces Lomse to render the caret on the new cursor position. The cursor is always necessary, as it provides a reference point for edition commands. But the caret is just a graphical widget that your application can use or not, depending of the needs. For instance, in a batch application it would be non-sense to use a Caret! For moving the cursor to another position your application just issue specific edition commands, such as <em>advance cursor</em> or <em>move cursor to start of score</em>.</p>
<p>Your application can also issue edition commands for selecting and deselecting document elements, such as paragraphs, words, notes, rests, clefs, staves, etc. Object SelectionSet is just the collection of current <em>selected</em> elements.</p>
<p>The DocCursor and the SelectionSet are not parameters of the commands. These objects are maintained by Lomse and when a command is going to be executed the necessary information about target objects and context is extracted from current cursor position and/or from current set of selected objects.</p>
<p>And this is, basically, the document edition API. It is very simple and gives full freedom to your application for implementing the edition GUI as you'd like, or for not a having it at all!</p>
<h1><a class="anchor" id="edit-modes"></a>
Supported edition modes</h1>
<p>What should be the behavior when inserting or deleting a note? For people with no previous experience with music edition software, the most intuitive behavior is one similar to what is expected from someone who comes from a pencil-and-paper background or from using a text processor: inserting/deleting a note or a rest shifts all the music that comes after it. But what about barlines? Should they be also shifted or should they remain at the same place? Each alternative has advantages and drawbacks:</p>
<ol type="1">
<li>If barlines are also shifted, current measure could result in an irregular measure. Let's name this behavior <em>limited ripple mode</em> (notes are shifted but limited to current measure because barline is also shifted).</li>
<li>If barlines remains at the same place and only notes and rests are shifted and can cross barlines boundaries and get placed in another measure, this behavior can be useful in some scenarios. For instance when you need to make one (ore more) beats completely disappear (and thus shift the remainder of the composition to the left by one beat). Or need two insert some <em>blank space</em> (one or more beats o whole measures), shifting to the right the rest of the music, and then you can fill in that space with what you wanted to insert. But, in general, this behavior causes a lot of trouble in music score edition. Notice that removing a note/rest in one voice and shifting all other notes in that voice implies completely <em>altering</em> the music in all the score, because music in shifted voice and music in the other voices and instruments are no longer synchronized. Let's name this behavior <em>full ripple mode</em> (notes are shifted across all the score).</li>
</ol>
<p>To avoid problems, another possibility is to change the behavior when a note or rest is inserted or deleted. In most cases you don't need to shift music. What you need is to add notes and rests in empty measures, but in measures having content what you need is to change a few notes or rests, but always keeping measures duration and not shifting the music. Let's call this behavior <em>replace mode</em> (the notes are replaced and measure duration is preserved).</p>
<p>None of these behaviors is perfect. What should be Lomse behavior? Although the most usual behavior in music edition programs is the <em>replace mode</em>, the other modes can be useful in some scenarios or for some applications. As Lomse aims at not creating unnecessary constrains to your application, it was decided to support the three behaviors. For this, all edition commands related to adding or removing notes and rests require an <em>edition mode</em> parameter for selecting the desired behavior:</p>
<ul>
<li><b>Limited ripple mode</b>: when inserting or deleting notes/rests the barlines are also shifted, and this could result in irregular measures, but other measures are not affected.</li>
<li><b>Replace mode</b>: Notes and rests are not inserted. Instead they <em>overwrite</em> the music so that measure duration is maintained. Also, notes are not deleted but replaced by rests.</li>
</ul>
<p>For supporting full ripple mode, instead of adding more complexity to commands related to adding or removing notes and rests, it is simpler, more flexible and causes less trouble to end users to use two specific insert/delete commands that always work in <em>full ripple mode</em>:</p>
<ul>
<li>insert blank space (beats or whole measures); and</li>
<li>delete beats/measures.</li>
</ul>
<p>These commands accepts a parameter defining the scope: to affect only one or selected voices, one or selected staves, one or selected instruments or the whole score.</p>
<dl class="section attention"><dt>Attention</dt><dd>Currently Lomse does not ensure the correctness of the music notation in operations resulting in music shifts. For instance, if a quarter note crosses a barline by the duration of a removed eighth note, the quarter note should be splitted into two tied eighth notes. Or when two tied notes in different measures are shifted an are now placed in the same measure, it is no longer clear if they should continue tied or should be replaced by a longer single note. As these decisions are not trivial, Lomse does not attempt (for now) to fix these situations and therefore the commands limit the operation to inserting or deleting the requested notes or rests without more considerations.</dd></dl>
<h1><a class="anchor" id="edit-commands"></a>
Edition commands</h1>
<p>This section presents a list of available commands (but more commands need to be programmed and a couple could be removed). For more information on each command read the class documentation for the command.</p>
<p><b><a class="el" href="classDocument.html">Document</a> edition commands:</b></p>
<ul>
<li><a class="el" href="classCmdAddChordNote.html">CmdAddChordNote()</a> - Add a new note to an existing note or chord.</li>
<li><a class="el" href="classCmdAddNoteRest.html">CmdAddNoteRest()</a> - Add a new note or rest at current cursor position.</li>
<li><a class="el" href="classCmdAddTie.html">CmdAddTie()</a> - Add a tie to the two selected notes.</li>
<li><a class="el" href="classCmdAddTuplet.html">CmdAddTuplet()</a> - Add a tuplet to the selected notes/rests.</li>
<li><a class="el" href="classCmdBreakBeam.html">CmdBreakBeam()</a> - Break a beam at the note/rest pointed by the cursor.</li>
<li><a class="el" href="classCmdChangeAccidentals.html">CmdChangeAccidentals()</a> - Change the accidentals of the selected notes.</li>
<li><a class="el" href="classCmdChangeAttribute.html">CmdChangeAttribute()</a> - Change the value of an attribute.</li>
<li><a class="el" href="classCmdChangeDots.html">CmdChangeDots()</a> - Change the number of dots in the selected notes and rests.</li>
<li><a class="el" href="classCmdDeleteBlockLevelObj.html">CmdDeleteBlockLevelObj()</a> - Delete a block level object (e.g. paragraph, music score, header, etc.).</li>
<li><a class="el" href="classCmdDeleteRelation.html">CmdDeleteRelation()</a> - Delete relation objects (e.g. beam, chord, slur, tie, tuplet, etc.).</li>
<li><a class="el" href="classCmdDeleteSelection.html">CmdDeleteSelection()</a> - Delete all selected objects.</li>
<li><a class="el" href="classCmdDeleteStaffObj.html">CmdDeleteStaffObj()</a> - Delete the staff object (e.g. note, rest, clef, barline, etc.) pointed by the cursor.</li>
<li><a class="el" href="classCmdInsertBlockLevelObj.html">CmdInsertBlockLevelObj()</a> - Insert a new block level object (e.g. paragraph, music score, header, etc.).</li>
<li><a class="el" href="classCmdInsertManyStaffObjs.html">CmdInsertManyStaffObjs()</a> - Insert a group of consecutive staff objects (e.g. note, rest, clef, barline, etc.).</li>
<li><a class="el" href="classCmdInsertStaffObj.html">CmdInsertStaffObj()</a> - Insert one staff object (e.g. a note, rest, clef, barline, etc.) at current cursor position.</li>
<li><a class="el" href="classCmdJoinBeam.html">CmdJoinBeam()</a> - Create and join beams, and add notes to a beam, depending on current selection.</li>
</ul>
<p><b>Selection commands:</b></p>
<ul>
<li><a class="el" href="classCmdSelection.html">CmdSelection()</a> - Changes the content of the set of selected objects.</li>
</ul>
<p><b>Cursor commands:</b></p>
<ul>
<li><a class="el" href="classCmdCursor.html">CmdCursor()</a> - Move the cursor to a new position. </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Overview</a></li>
    <li class="footer">Generated on Tue Apr 10 2018 11:43:56 for Lomse library. API documentation by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
