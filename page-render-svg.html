<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Lomse library. API documentation: Render in SVG format</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="lomse.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_100x195.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Lomse library. API documentation
   &#160;<span id="projectnumber">0.30.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('page-render-svg.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Render in SVG format </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#svg-rendering">How to render SVG</a></li>
<li class="level1"><a href="#rendering-svg-formatting">SVG formatting options</a></li>
<li class="level1"><a href="#rendering-svg-attributes">SVG &#39;id&#39; and &#39;class&#39; attributes</a></li>
<li class="level1"><a href="#rendering-svg-many-shapes">Id for notations that generate many images</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="svg-rendering"></a>
How to render SVG</h1>
<p>The SVG rendering facilities are very simple. It is basically opening a document and requesting its rendition. The View will render the document on a std::ostream that your application must provide, and once Lomse has generated the SVG code, it is your application responsibility to do whatever is needed with that code: injecting it in an HTML page and displaying it on a browser window embedded into your application, exporting it as an image file, etc. For instance:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacestd.html">std</a>;</div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;lomse_doorway.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;lomse_graphic_view.h&gt;</span>     <span class="comment">//for view types</span></div><div class="line"><span class="preprocessor">#include &lt;lomse_interactor.h&gt;</span>       <span class="comment">//Interactor</span></div><div class="line"><span class="keyword">using namespace </span>lomse;</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">    <span class="comment">//create the instance of the library doorway</span></div><div class="line">    lomse::LomseDoorway lomse;</div><div class="line"></div><div class="line">    <span class="comment">//open an score</span></div><div class="line">    lomse::Presenter* pPresenter = </div><div class="line">        lomse.open_document(k_view_vertical_book,</div><div class="line">                            <span class="stringliteral">&quot;&lt;path&gt;/&lt;to&gt;/&lt;the&gt;/MusicXMLscore.xml&quot;</span>);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (SpInteractor spInteractor = pPresenter-&gt;get_interactor(0).lock())</div><div class="line">    {</div><div class="line">        <span class="comment">//generate the SVG rendition for the first page</span></div><div class="line">        std::stringstream svg;</div><div class="line">        <span class="keywordtype">int</span> page = 0;</div><div class="line">        pIntor-&gt;svg_add_newlines(<span class="keyword">true</span>);     <span class="comment">//for human legibility</span></div><div class="line">        spInteractor-&gt;render_as_svg(svg, page);</div><div class="line"></div><div class="line">        <span class="comment">//do whatever you like with the svg code</span></div><div class="line">        cout &lt;&lt; svg.str() &lt;&lt; endl;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;Could not open document!&quot;</span> &lt;&lt; endl;</div><div class="line"></div><div class="line">    </div><div class="line">    <span class="keyword">delete</span> pPresenter;</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p>Lomse behaviour for generating SVG is as follows:</p>
<ul>
<li>The lomse infinite logical space is also the infinite SVG document canvas.</li>
<li>Lomse generates SVG code to render the View type specified when opening/creating de document. The generated SVG code is only the <em>&lt;svg&gt;</em> element and all its content but it does not contain “width” and “height” attributes. Therefore, the behaviour will depend on how your application uses the generated SVG code. For instance, if the SVG code is inserted in an HTML page, the <em>&lt;svg&gt;</em> element will inherit the “width” and “height” attributes from the context.</li>
<li>For View types oriented to generate pages (<em>k_view_vertical_book</em> and <em>k_view_horizontal_book</em>) the SVG viewBox is adjusted to include only a whole page and the page to generate is selected when invoking the render_as_svg() method.</li>
<li>For the other View types the SVG viewBox is adjusted to cover the full document.</li>
<li>For View types oriented to pages, the width of the document determines the width of the viewBox. But for the <em>k_view_free_flow</em> View type, there is no reference for Lomse about the target width and thus, your application must first inform Lomse of the desired width before invoking the SVG rendering method:</li>
</ul>
<div class="fragment"><div class="line">interactor-&gt;set_svg_canvas_width(Pixels x);</div></div><!-- fragment --><p>This method only works for <em>k_view_free_flow</em>. For all other view types any value set using this method will be overriden by the document page width.</p>
<h1><a class="anchor" id="rendering-svg-formatting"></a>
SVG formatting options</h1>
<p>Default behaviour is to generate the most compact SVG code and, therefore, it does not include new lines, indentation, or other formatting elements. Nevertheless, to facilitate reading by humans or for other purposes, you can use methods <a class="el" href="classInteractor.html#afb078f8048218a16e433ee74f5d38501">Interactor::svg_indent()</a> and <a class="el" href="classInteractor.html#a3b76dce8cfd386733b6241b7ba3b515a">Interactor::svg_add_newlines()</a>. For instance:</p>
<div class="fragment"><div class="line">std::stringstream svg;</div><div class="line"><span class="keywordtype">int</span> page = 0;</div><div class="line">pIntor-&gt;svg_indent(4);              <span class="comment">//4 spaces per indentation level</span></div><div class="line">pIntor-&gt;svg_add_newlines(<span class="keyword">true</span>);     <span class="comment">//add a line break after each element</span></div><div class="line">spInteractor-&gt;render_as_svg(svg, page);</div></div><!-- fragment --><h1><a class="anchor" id="rendering-svg-attributes"></a>
SVG 'id' and 'class' attributes</h1>
<p>The generation of 'id' and 'class' attributes in SVG elements is optional. Default behaviour is to generate the most compact SVG code and, therefore, 'id' and 'class' attributes are not generated. But if your applications would like to identify or manipulate the generated SVG elements, it is optional to generate either 'id', 'class' or both. For this you can use methods <a class="el" href="classInteractor.html#af813bf9d59ac9f48e09e91f059e3449e">Interactor::svg_add_id()</a> and <a class="el" href="classInteractor.html#a6ae3c8d90f9085f15d86aae5ddc6fa7b">Interactor::svg_add_class()</a>. For instance:</p>
<div class="fragment"><div class="line">std::stringstream svg;</div><div class="line"><span class="keywordtype">int</span> page = 0;</div><div class="line">pIntor-&gt;svg_add_id(<span class="keyword">true</span>);       <span class="comment">//add attribute &#39;id&#39;</span></div><div class="line">pIntor-&gt;svg_add_class(<span class="keyword">true</span>);    <span class="comment">//add attribute &#39;class&#39;</span></div><div class="line">spInteractor-&gt;render_as_svg(svg, page);</div></div><!-- fragment --><p>The 'id' is always letter 'm' followed by the id of the musical notation, e.g. <em>'m412'</em>. Optionally, when a musical notation can generate more than one image (e.g. the clef repeated in every staff or the instrument name repeated in every system) the 'id' will be followed by a suffix to make it unique. See below for details.</p>
<p>Notations that always generate a single SVG element will never be enclosed by a <em>&lt;g&gt;</em> element, e.g.:</p>
<div class="fragment"><div class="line">&lt;text <span class="keywordtype">id</span>=<span class="stringliteral">&#39;m78&#39;</span> <span class="keyword">class</span>=<span class="stringliteral">&#39;clef&#39;</span> ... &gt;...&lt;/text&gt;</div></div><!-- fragment --><p>But notations that can generate two or more SVG elements will always be enclosed in a <em>&lt;g&gt;</em> element, e.g. a D major key signature:</p>
<div class="fragment"><div class="line">&lt;g <span class="keywordtype">id</span>=<span class="stringliteral">&#39;m83&#39;</span> <span class="keyword">class</span>=<span class="stringliteral">&#39;note&#39;</span>&gt;</div><div class="line">    &lt;path <span class="keyword">class</span>=<span class="stringliteral">&#39;ledger-line&#39;</span> ... /&gt;</div><div class="line">    &lt;text <span class="keyword">class</span>=<span class="stringliteral">&#39;notehead&#39;</span> ... &gt;...&lt;/text&gt;</div><div class="line">    &lt;path <span class="keyword">class</span>=<span class="stringliteral">&#39;stem&#39;</span> ... /&gt;</div><div class="line">&lt;/g&gt;</div><div class="line"></div><div class="line">&lt;g <span class="keywordtype">id</span>=<span class="stringliteral">&#39;m36&#39;</span> <span class="keyword">class</span>=<span class="stringliteral">&#39;key-signature&#39;</span>&gt;</div><div class="line">    &lt;text <span class="keyword">class</span>=<span class="stringliteral">&#39;accidental-sign&#39;</span> ... &gt;...&lt;/text&gt;</div><div class="line">    &lt;text <span class="keyword">class</span>=<span class="stringliteral">&#39;accidental-sign&#39;</span> ... &gt;...&lt;/text&gt;</div><div class="line">&lt;/g&gt;</div></div><!-- fragment --><p>Note that for notations that require a <em>&lt;g&gt;</em> element, when the notation does not have visible content (e.g. a C major key signature), the generated code would be just an empty <em>&lt;g&gt;</em> element:</p>
<div class="fragment"><div class="line">&lt;g <span class="keywordtype">id</span>=<span class="stringliteral">&#39;m36&#39;</span> <span class="keyword">class</span>=<span class="stringliteral">&#39;key-signature&#39;</span>&gt;</div><div class="line">&lt;/g&gt;</div></div><!-- fragment --><p>Complex notations could have two or more levels of <em>&lt;g&gt;</em> elements, e.g.:</p>
<div class="fragment"><div class="line">&lt;g <span class="keywordtype">id</span>=<span class="stringliteral">&#39;m39&#39;</span> <span class="keyword">class</span>=<span class="stringliteral">&#39;note&#39;</span>&gt;</div><div class="line">    &lt;path <span class="keyword">class</span>=<span class="stringliteral">&#39;ledger-line&#39;</span> ... /&gt;</div><div class="line">    &lt;text <span class="keyword">class</span>=<span class="stringliteral">&#39;notehead&#39;</span> ... &gt;...&lt;/text&gt;</div><div class="line">    &lt;g <span class="keywordtype">id</span>=<span class="stringliteral">&#39;m40&#39;</span> <span class="keyword">class</span>=<span class="stringliteral">&#39;arpeggio&#39;</span>&gt;</div><div class="line">        &lt;text ... &gt;...&lt;/text&gt;</div><div class="line">        &lt;text ... &gt;...&lt;/text&gt;</div><div class="line">    &lt;/g&gt;</div><div class="line">    &lt;path <span class="keyword">class</span>=<span class="stringliteral">&#39;stem&#39;</span> ... /&gt;</div><div class="line">&lt;/g&gt;</div></div><!-- fragment --><h1><a class="anchor" id="rendering-svg-many-shapes"></a>
Id for notations that generate many images</h1>
<p>For musical notations that generate more than one image (e.g. the clef repeated in every staff or the instrument name repeated in every system) the 'id' will be followed by a suffix to make it unique. The structure of this suffix depend on each notation:</p>
<p><b>a) Clefs and key signatures</b></p>
<p>Clefs and key signatures will normally generate many images, as they are repeated at start of every system. The id of these repeated images is the id of the music notation followed by a unique number (not necessarily in sequence), e.g.:</p>
<div class="fragment"><div class="line">&lt;text <span class="keywordtype">id</span>=<span class="stringliteral">&#39;m40&#39;</span> <span class="keyword">class</span>=<span class="stringliteral">&#39;clef&#39;</span> ...&gt;...&lt;/text&gt;      The first image</div><div class="line">&lt;text <span class="keywordtype">id</span>=<span class="stringliteral">&#39;m40-3&#39;</span> <span class="keyword">class</span>=<span class="stringliteral">&#39;clef&#39;</span> ...&gt;...&lt;/text&gt;    Image in next system</div><div class="line">&lt;text <span class="keywordtype">id</span>=<span class="stringliteral">&#39;m40-12&#39;</span> <span class="keyword">class</span>=<span class="stringliteral">&#39;clef&#39;</span> ...&gt;...&lt;/text&gt;   etc.</div></div><!-- fragment --><p><b>b) Images generated by an instrument (score part)</b></p>
<p>A score part (Lomse instrument) is responsible for drawing several elements, such as the staff lines, part name, part abbreviation, braces, etc. The id for these elements will be always the id of the instrument (e.g. <em>'m59'</em>) followed by a suffix composed as follows:</p>
<ul>
<li><b>brace:</b> string <em>"brace-n"</em>, where <em>n</em> is the system number (1...n).</li>
<li><b>instrument</b> <b>name:</b> string <em>"name-n"</em>, where <em>n</em> is the system number (1...n).</li>
<li><b>instrument</b> <b>abbreviation:</b> string <em>"abbrev-n"</em>, where <em>n</em> is the system number (1...n).</li>
<li><b>staff</b> <b>lines:</b> string <em>"staff-m-n"</em>, where <em>m</em> is the staff number (1...n) and n is the system number (1...n).</li>
</ul>
<p>For example: </p><div class="fragment"><div class="line">&lt;path <span class="keywordtype">id</span>=<span class="stringliteral">&#39;m59-brace-1&#39;</span> <span class="keyword">class</span>=<span class="stringliteral">&#39;instr-brace&#39;</span> ... /&gt;       Brace in 1st system</div><div class="line">&lt;path <span class="keywordtype">id</span>=<span class="stringliteral">&#39;m59-staff-1-1&#39;</span> <span class="keyword">class</span>=<span class="stringliteral">&#39;staff-lines&#39;</span> ... /&gt;     Lines, staff 1, system 1</div><div class="line">&lt;path <span class="keywordtype">id</span>=<span class="stringliteral">&#39;m59-staff-2-1&#39;</span> <span class="keyword">class</span>=<span class="stringliteral">&#39;staff-lines&#39;</span> ... /&gt;     Lines, staff 2, system 1</div><div class="line">&lt;text <span class="keywordtype">id</span>=<span class="stringliteral">&#39;m59-name-1&#39;</span> <span class="keyword">class</span>=<span class="stringliteral">&#39;instr-name&#39;</span> ... &gt;          Instr. name in 1st system</div><div class="line"></div><div class="line">&lt;path <span class="keywordtype">id</span>=<span class="stringliteral">&#39;m59-brace-2&#39;</span> <span class="keyword">class</span>=<span class="stringliteral">&#39;instr-brace&#39;</span> ... /&gt;       Brace in 2nd system</div><div class="line">&lt;path <span class="keywordtype">id</span>=<span class="stringliteral">&#39;m59-staff-1-2&#39;</span> <span class="keyword">class</span>=<span class="stringliteral">&#39;staff-lines&#39;</span> ... /&gt;     Lines, staff 1, system 2</div><div class="line">&lt;path <span class="keywordtype">id</span>=<span class="stringliteral">&#39;m59-staff-2-2&#39;</span> <span class="keyword">class</span>=<span class="stringliteral">&#39;staff-lines&#39;</span> ... /&gt;     Lines, staff 2, system 2</div><div class="line">&lt;text <span class="keywordtype">id</span>=<span class="stringliteral">&#39;m59-abbrev-2&#39;</span> <span class="keyword">class</span>=<span class="stringliteral">&#39;instr-abbrev&#39;</span> ... &gt;      Instr. abbreviation, sys.2</div></div><!-- fragment --><p><b>c) Images generated by a group of instruments</b></p>
<p>Instruments can be grouped using braces and brackets and the groups can have names and abbreviations. The id for these elements will be always the id of the group (e.g. <em>'m134'</em>) followed by a suffix composed as follows:</p>
<ul>
<li><b>brace:</b> string <em>"brace-n"</em>, where <em>n</em> is the system number (1...n).</li>
<li><b>bracket:</b> string <em>"bracket-n"</em>, where <em>n</em> is the system number (1...n).</li>
<li><b>squared</b> <b>bracket:</b> string <em>"squared-bracket-n"</em>, where <em>n</em> is the system number (1...n).</li>
<li><b>group</b> <b>name:</b> string <em>"name-n"</em>, where <em>n</em> is the system number (1...n).</li>
<li><b>group</b> <b>abbreviation:</b> string <em>"abbrev-n"</em>, where <em>n</em> is the system number (1...n).</li>
</ul>
<p>For example: </p><div class="fragment"><div class="line">&lt;path <span class="keywordtype">id</span>=<span class="stringliteral">&#39;m134-bracket-1&#39;</span> <span class="keyword">class</span>=<span class="stringliteral">&#39;group-bracket&#39;</span> ... /&gt;   Bracket in 1st system</div><div class="line">&lt;text <span class="keywordtype">id</span>=<span class="stringliteral">&#39;m134-name-1&#39;</span> <span class="keyword">class</span>=<span class="stringliteral">&#39;group-name&#39;</span> ... &gt;          Group name in 1st system</div><div class="line"></div><div class="line">&lt;path <span class="keywordtype">id</span>=<span class="stringliteral">&#39;m134-bracket-2&#39;</span> <span class="keyword">class</span>=<span class="stringliteral">&#39;group-bracket&#39;</span> ... /&gt;   Bracket in 2nd system</div><div class="line">&lt;text <span class="keywordtype">id</span>=<span class="stringliteral">&#39;m134-abbrev-2&#39;</span> <span class="keyword">class</span>=<span class="stringliteral">&#39;group-abbrev&#39;</span> ... &gt;      Group abbreviation, sys.2</div></div><!-- fragment --><p><b>d) Systemic barlines</b></p>
<p>Systemic barlines are the barlines at start of each system, joining all staves in the system. The id for systemic barlines is always the id of the score (e.g. <em>'m2'</em>) followed by string <em>"barline"</em> and the system count (1 for the first system): e.g.:</p>
<div class="fragment"><div class="line">&lt;path <span class="keywordtype">id</span>=<span class="stringliteral">&#39;m2-barline-1&#39;</span> <span class="keyword">class</span>=<span class="stringliteral">&#39;systemic-barline&#39;</span> ... /&gt;    Barline <span class="keywordflow">for</span> 1st system</div><div class="line">&lt;path <span class="keywordtype">id</span>=<span class="stringliteral">&#39;m2-barline-2&#39;</span> <span class="keyword">class</span>=<span class="stringliteral">&#39;systemic-barline&#39;</span> ... /&gt;    Barline <span class="keywordflow">for</span> 2nd system</div></div><!-- fragment --><p><b>e) Measure numbers</b></p>
<p>Measure numbers are normally associated to the first instrument (score part) in the score, but for polymetric music the numers are different in each instrument and will go associated to the respective instrument. Therefore, measure numbers are always associated to an instrument and its id is the id of the instrument followed by string <em>"measure-num"</em> and the measure index: e.g.:</p>
<div class="fragment"><div class="line">&lt;text <span class="keywordtype">id</span>=<span class="stringliteral">&#39;m35-measure-num-1&#39;</span> <span class="keyword">class</span>=<span class="stringliteral">&#39;measure-number&#39;</span> ... &gt;...&lt;/text&gt;</div><div class="line">&lt;text <span class="keywordtype">id</span>=<span class="stringliteral">&#39;m35-measure-num-5&#39;</span> <span class="keyword">class</span>=<span class="stringliteral">&#39;measure-number&#39;</span> ... &gt;...&lt;/text&gt;</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Overview</a></li>
    <li class="footer">Generated on Tue Oct 25 2022 19:12:48 for Lomse library. API documentation by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
