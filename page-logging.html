<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Lomse library. API documentation: The logging system</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="lomse.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_100x195.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Lomse library. API documentation
   &#160;<span id="projectnumber">0.29.3</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('page-logging.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">The logging system </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#logging-overview">Logging disabling and customization</a></li>
<li class="level1"><a href="#logging-methods">Logging methods</a></li>
<li class="level1"><a href="#logging-areas">Logging areas and messages selection</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="logging-overview"></a>
Logging disabling and customization</h1>
<p>Lomse has a logging system initially created as a help for developing the Lomse library but that can also be used by your application.</p>
<p>The logging system consists in two log streams: a <em>normal log</em> that should receive all log messages and a <em>forensic log</em> that was intended to be submitted, if the user agrees, to your server and that would contain only dumps and other debugging information for severe errors causing a crash. By default Lomse initializes the logging system to log messages in two files: lomse-log.txt and forensic_log.txt. These files are, by default, placed in the user home folder.</p>
<p>Applications using Lomse can customize the way Lomse does its logging, to disable it, to put the logs in an application-specific directory, or to redirect the logs to another destination, such as standard output/error streams (stdout/stderr) or a platform-specific logging system (such Android Logcat). For this, your application has two options. The first one is to specify the logging configuration when creating the <a class="el" href="classLomseDoorway.html">LomseDoorway</a> object, by providing custom std::ostream objects to be used by the logger. For example: </p><div class="fragment"><div class="line"><span class="comment">//e.g. use std::cout for normal log and std::cerr for forensic log</span></div><div class="line"><a class="code" href="classLomseDoorway.html">LomseDoorway</a> m_lomse(&amp;std::cout, &amp;std::cerr);</div></div><!-- fragment --><p>The other option is to initialize the logging system before creating the <a class="el" href="classLomseDoorway.html">LomseDoorway</a> object, by calling lomse::get_global_logger().init() and providing custom std::ostream objects to be used by the logger, for example: </p><div class="fragment"><div class="line"><span class="comment">//e.g. use std::cout for normal log and std::cerr for forensic log</span></div><div class="line">lomse::get_global_logger().init(&amp;std::cout, &amp;std::cerr);</div></div><!-- fragment --><p>If custom log streams are not provided, Lomse initializes the logging system for using the default logging configuration (the predefined normal and forensic log files): </p><div class="fragment"><div class="line"><span class="comment">//use default files lomse-log.txt and forensic_log.txt for logging</span></div><div class="line"><a class="code" href="classLomseDoorway.html">LomseDoorway</a> m_lomse;</div></div><!-- fragment --><p>Your application can also disable logging by supplying an std::ostream which does nothing with its input. Lomse provides a default <em>nullLogger</em> stream for this. For instance: </p><div class="fragment"><div class="line"><span class="comment">//initialize lomse with logging disabled</span></div><div class="line"><a class="code" href="classLomseDoorway.html">LomseDoorway</a> m_lomse(&amp;lomse::nullLogger, &amp;lomse::nullLogger);</div></div><!-- fragment --><p>At any moment, your application can reset the logging system to the default configuration in case the provided streams somehow get invalidated:</p>
<div class="fragment"><div class="line">lomse::get_global_logger().deinit();</div></div><!-- fragment --><p>An can re-initialize again at any moment after de-initialization with any desired configuration: </p><div class="fragment"><div class="line"><span class="comment">//e.g. use std::cout for normal log and disable forensic log</span></div><div class="line">lomse::get_global_logger().init(&amp;std::cout, &amp;lomse::nullLogger);</div></div><!-- fragment --><h1><a class="anchor" id="logging-methods"></a>
Logging methods</h1>
<p>Lomse provides several macros for recording log messages, all of them having the same syntax as <code>printf()</code>: they take the format string as the first argument and a variable number of arguments. For instance: </p><div class="fragment"><div class="line">LOMSE_LOG_INFO(<span class="stringliteral">&quot;key=%s, Path=%s&quot;</span>, key.c_str(), fullpath.c_str());</div></div><!-- fragment --><p>The generated log message <b>always includes the file, line and method</b> where the message was generated, as well as a short tag (ERROR, INFO, etc.) for each message type, for example, the previous example generates the following log message: </p><div class="fragment"><div class="line">lomse_linux.cpp, line 189. INFO: [lomse::FontSelector::find_font] key=anyBravura00, Path=/usr/local/share/fonts/Bravura.otf</div></div><!-- fragment --><p>Three macros are always usable and generate log messages in both debug and release builds:</p>
<ul>
<li>LOMSE_LOG_ERROR(...) is the macro to use for error messages, e.g. messages that must be investigated as they suggest some kind of bug.</li>
<li>LOMSE_LOG_INFO(...) is for all normal, informational messages, that you would like to log for saving information that can be useful in case of having to investigate an error, e.g. configuration parameters.</li>
<li>LOMSE_LOG_WARN(...) is for warnings, you define what is it, e.g. informative messages that should be investigated.</li>
</ul>
<p>Two additional macros have a parameter <em>area</em> before the message format string. This parameter allows to restrict the amount of messages generated by only logging those related to the area being debugged. This area parameter is explained in the next section. The two macros oriented to debugging code are:</p>
<ul>
<li>LOMSE_LOG_DEBUG(area, ...) is the right macro for debug output.</li>
<li>LOMSE_LOG_TRACE(area, ...) is also for debug messages. The reason for making it a separate function from LOMSE_LOG_DEBUG is that usually debug messages are required only in very specific situations and are 'intrusive' (makes code less legible); therefore, these logging statements will probably be removed from the code as soon as it is debugged. But trace messages are normally less intrusive (e.g. just a line to record entering or exiting a method) and could be left in place to facilitate future debugging needs.</li>
</ul>
<dl class="section attention"><dt>Attention</dt><dd>When using LOMSE_LOG_DEBUG and LOMSE_LOG_TRACE in your application they will only generate code if option LOMSE_ENABLE_DEBUG_LOGS was set in lomse_config.h when building the Lomse library. It is irrelevant if Lomse built was debug or release.</dd></dl>
<h1><a class="anchor" id="logging-areas"></a>
Logging areas and messages selection</h1>
<p>As you develop your application code, it could contain many LOMSE_LOG_XXXX statements. Probably, as your application code is more mature and complete you will not need many of the logging statements but you could be reluctant to remove them as they can be of help in case of having to do some debugging in future. But the problem of maintaining them is that the log get flooded with messages and this makes more difficult and tedious to focus on the relevant messages for the current problem to debug.</p>
<p>To limit logging to only relevant messages without having to remove logging statements in other places, you may use Logger::set_logging_areas() and Logger::set_logging_mode() methods.</p>
<p>Logger::set_logging_mode() controls what messages will be generated. Currently there exist three modes:</p><ul>
<li>In <em>k_normal_mode</em> only ERROR, INFO and WARN messages are logged.</li>
<li>In <em>k_debug_mode</em> also DEBUG messages are logged.</li>
<li>In <em>k_trace_mode</em> all messages are logged.</li>
</ul>
<p>The default configuration is <em>k_normal_mode</em> so debug and trace messages will not be recorded.</p>
<p>When debug and/or trace messages are enabled, you can restrict theses messages to only those relevant to one or more code areas. An <em>area</em> is just an arbitrary identifier for the component, modules, or methods relevant to debug a functionality. For instance, for Lomse code there are currently six areas defined:</p><ul>
<li><em>k_events</em>, used for all logging statements relevant for debugging lomse events.</li>
<li><em>k_mvc</em>, used for all messages related to the creation/destruction of the MVC model objects.</li>
<li><em>k_score_player</em>, used for all messages related to score playback.</li>
<li><em>k_render</em>, used for all messages related to rendering.</li>
<li><em>k_layout</em>, used for all messages related to layout.</li>
<li><em>k_gmodel</em>, used for all messages related to graphic model creation</li>
</ul>
<p>In Lomse there are 16 areas reserved for your application, named <em>k_user1</em> to <em>k_user16</em>. They do not have any predefined meaning and it is your application who define the purpose of each area.</p>
<p>If a LOMSE_LOG_DEBUG or LOMSE_LOG_TRACE macro is applicable to several areas you can specify all them by using the <em>logical or</em> operator, for instance: </p><div class="fragment"><div class="line">LOMSE_LOG_TRACE(Logger::k_user5 | Logger::k_user7, <span class="stringliteral">&quot;This is the value: %d&quot;</span>, value);</div></div><!-- fragment --><p>Special area <em>Logger::k_all</em> can be used to make a message applicable to any area. It can also be used in Logger::set_logging_areas() for selecting all areas.</p>
<p>For using the logging system in your application, after initializing Lomse you need to include two logging configuration statements: </p><div class="fragment"><div class="line">lomse::logger.set_logging_mode(Logger::k_trace_mode);                   <span class="comment">//enable normal, debug and trace msgs.</span></div><div class="line">lomse::logger.set_logging_areas(Logger::k_user2 | Logger::k_user7);     <span class="comment">//but only for areas user1 and user7</span></div><div class="line"><span class="comment">//AWARE: debug and trace messages will be recorded only when lomse is built with option LOMSE_ENABLE_DEBUG_LOGS</span></div></div><!-- fragment --><p>As you develop your code you will need to change these options. And when building the release version you will need to change the log mode to normal: </p><div class="fragment"><div class="line">lomse::logger.set_logging_mode(Logger::k_normal_mode);  <span class="comment">//enable only error, info and warning messages</span></div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Overview</a></li>
    <li class="footer">Generated on Sun Aug 7 2022 17:33:20 for Lomse library. API documentation by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
